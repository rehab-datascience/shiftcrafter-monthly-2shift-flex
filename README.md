# ShiftCrafter Part 4 — 時短対応（月次・2交代＋時短）MVP

二交代制（**日勤 8:30–17:00 / 夜勤 17:00–翌9:00**）に **時短日勤（例：9:00–16:00）** を組み込み、**1か月**のシフトをブラウザだけで自動割当。  
**CSV / ICS / 検証CSV** 出力に対応。データは外部送信しません（クライアントサイド完結）。

## 使い方（最短）

1. `index.html` をPCブラウザで開く（Chrome推奨）
2. 左パネルで以下を入力  
   - 対象月（YYYY-MM）  
   - 必要人数（**日勤換算**／夜勤）  
   - 週あたり／（任意）月あたりの夜勤上限  
   - 職員（**通常日勤/夜勤対応**）リスト  
   - 職員（**時短日勤のみ**）リスト  
   - 休み希望（例：`2025-11-03 田中`）  
   - 時短の重み（既定 **0.8**）、時短の時刻（既定 **09:00–16:00**）
3. 「シフト自動作成」→「CSV／ICS／検証CSV」をダウンロード

## 出力

- **schedule_monthly_part4.csv（wide）**  
  `date, dow, need_day, need_night, day_full_*, day_short_*, night_*`
- **shift_monthly_part4.ics**  
  - 日勤（通常）: 08:30–17:00  
  - 日勤（時短）: 入力に従う（既定 09:00–16:00）  
  - 夜勤: 17:00–翌09:00  
  - `SUMMARY: 日勤(通常)：氏名 / 日勤(時短)：氏名 / 夜勤：氏名`
- **validation_summary_part4.csv**  
  - `weighted_day_coverage_pct`: **重み付き日勤充足率**（full=1.0 / short=重み）  
  - `off_fulfillment_pct`: 希望休充足率（個人別）  
  - `weekly_night_cap_violations / monthly_night_cap_violation`  
  - `consec_night_2plus`: 連続夜勤  
  - `day_after_night_violation`: 夜勤翌日の日勤（禁止ルールの監視）

## 割当ロジック（MVP）

1. 夜勤を先に割当（週・月の夜勤上限、希望休を遵守）  
2. 日勤は**通常**で `need_day` をできる限り充当  
3. なお不足分を**時短**で重み付き補完（例：short=0.8 を加点し、必要値に到達まで追加）

> ※ 「Night→翌Day禁止」、同日重複割当禁止。時短は夜勤に割り当てません。

## 制約・注意

- MVPは**公平性最適化**（偏り抑制）を簡易ルールに留めています。  
- 必要人数は月内で共通（将来：日別プロファイルで拡張予定）。  
- **時短の重み**は現場のルールに合わせて変更してください。  
- CSVはUTF-8（BOM付き）、ICSはAsia/Tokyoで出力。

## 将来拡張（例）

- **土日出勤なし**スタッフ：曜日属性をもち、候補抽出時に除外  
- **夜勤なし**スタッフ：ロール属性で夜勤プールから除外  
- 日別必要人数プロファイル（平日/土日/祝日）  
- 各人の就業時間（分単位）と**線形最適化**による偏り最小化

## ライセンス

MIT（予定）
